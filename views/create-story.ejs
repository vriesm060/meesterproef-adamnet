<%- include('partials/head.ejs') %>
<body class="create-story">
	<div class="grid">
		<section class="map-visualisation">
			<div id="map"></div>
			<a class="back" href="http://localhost:3000/new-story"/><img src="/images/arrow-down.svg" alt="back-button"/></a>
		</section>

		<nav class="table-of-contents">
			<button class="open">
				<svg class="navicon" height="32px" id="Layer_1" style="enable-background:new 0 0 32 32;" version="1.1" viewBox="0 0 32 32" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
				<path d="M4,10h24c1.104,0,2-0.896,2-2s-0.896-2-2-2H4C2.896,6,2,6.896,2,8S2.896,10,4,10z M28,14H4c-1.104,0-2,0.896-2,2  s0.896,2,2,2h24c1.104,0,2-0.896,2-2S29.104,14,28,14z M28,22H4c-1.104,0-2,0.896-2,2s0.896,2,2,2h24c1.104,0,2-0.896,2-2  S29.104,22,28,22z"/>
				</svg>
			</button>
			<button class="close">
				<svg class="navicon" height="32px" id="Layer_1" style="enable-background:new 0 0 32 32;" version="1.1" viewBox="0 -5 32 32" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
				<path d="M14.1,11.3c-0.2-0.2-0.2-0.5,0-0.7l7.5-7.5c0.2-0.2,0.3-0.5,0.3-0.7s-0.1-0.5-0.3-0.7l-1.4-1.4C20,0.1,19.7,0,19.5,0  c-0.3,0-0.5,0.1-0.7,0.3l-7.5,7.5c-0.2,0.2-0.5,0.2-0.7,0L3.1,0.3C2.9,0.1,2.6,0,2.4,0S1.9,0.1,1.7,0.3L0.3,1.7C0.1,1.9,0,2.2,0,2.4  s0.1,0.5,0.3,0.7l7.5,7.5c0.2,0.2,0.2,0.5,0,0.7l-7.5,7.5C0.1,19,0,19.3,0,19.5s0.1,0.5,0.3,0.7l1.4,1.4c0.2,0.2,0.5,0.3,0.7,0.3  s0.5-0.1,0.7-0.3l7.5-7.5c0.2-0.2,0.5-0.2,0.7,0l7.5,7.5c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l1.4-1.4c0.2-0.2,0.3-0.5,0.3-0.7  s-0.1-0.5-0.3-0.7L14.1,11.3z"/>
				</svg>
			</button>
			<ol class="menu">
				<a class="save-story-btn" role="button" href="/save-story">Verhaal opslaan</a>
				<% for(var i = 0; i < Object.keys(dataFirstQuery.years).length; i++) { %>
					<li>
						<details>
						  <summary><h1 class="year-title"><%- Object.keys(dataFirstQuery.years)[i] %></h1></summary>
								<% var objectYears = dataFirstQuery.years[Object.keys(dataFirstQuery.years)[i]]; %>
								<% for(var j = 0; j < Object.keys(objectYears).length; j++) { %>
									<a href="#<%- Object.keys(dataFirstQuery.years)[i] %>-<%- Object.keys(objectYears)[j].replace(/\s/g,'') %>"><%- Object.keys(objectYears)[j] %></a>
								<% } %>
								<button class="add-chapter-btn" type="button">+</button>
						</details>
					</li>
				<% } %>
			</ol>
		</nav>

		<main class="contents">
			<section class="personal-data">
				<form action="/create-story" method="post">
					<input class="title" type="text" name="title" placeholder="Geef jouw verhaal een titel.." autocomplete="off">

					<div>
						<label for="name">Dit is het verhaal over:</label>
						<input id="name" name="name" type="text" placeholder="Jan Jansen.." autocomplete="off">
					</div>
					<div>
						<label for="year">Geboren in:</label>
						<input id="year" name="year" type="number" placeholder="1969" min="1900" max="2018">
					</div>

					<button type="submit">Opslaan</button>
				</form>
			</section>
			<% for(var i = 0; i < Object.keys(dataFirstQuery.years).length; i++) { %>
				<section id="<%- Object.keys(dataFirstQuery.years)[i] %>" class="year <%- Object.keys(dataFirstQuery.years)[i] %>">
					<% var objectYears = dataFirstQuery.years[Object.keys(dataFirstQuery.years)[i]]; %>
					<% for(var j = 0; j < Object.keys(objectYears).length; j++) { %>

						<%- include('partials/chapter.ejs', {i: i, j: j, objectYears: objectYears}) %>

					<% } %>
				</section>
			<% } %>
		</main>
	</div>

	<script>
		window.data = <%- JSON.stringify(dataFirstQuery || null) %>;
		console.log(window.data)
	</script>
	<script>
		var trigger = document.querySelectorAll('.openDetail');
		var detailpopup = document.querySelectorAll('.detail');
		var closeButton = document.querySelectorAll('.popupCloseButton');

		for(var i = 0; i < trigger.length; i++) {
			trigger[i].addEventListener('click', function(e){
				e.preventDefault();
				e.path[3].childNodes[3].classList.add('show');
			});

			detailpopup[i].addEventListener('click', function(e){
				e.preventDefault();
				e.target.parentElement.classList.remove('show')
			});

			closeButton[i].addEventListener('click', function(e){
				e.preventDefault();
				e.target.parentElement.parentElement.classList.remove('show')
			});
		}
	</script>
	<script>
		if('querySelector' in document && 'querySelectorAll' in document && 'addEventListener' in window) {
			var open = document.querySelector('.open');
			var close = document.querySelector('.close');
			var menu = document.querySelector('nav ol');
			var items = document.querySelectorAll('nav ol li');

			menu.classList.add('first');

			open.addEventListener('click', function(){
				menu.classList.add('open-menu');
				menu.classList.remove('close-menu');

				open.style.display = "none";
				close.style.display = "block";
			})

			close.addEventListener('click', function(){
				menu.classList.remove('open-menu');
				menu.classList.add('close-menu');

				close.style.display = "none";
				open.style.display = "block";
			})

			items.forEach(function(el){
				el.addEventListener('click', function(){
					menu.classList.remove('open-menu');
					menu.classList.add('close-menu');

					close.style.display = "none";
					open.style.display = "block";
				})
			})
		}
	</script>
	<script>
	var sections = document.querySelectorAll('section.year');
	var main = document.querySelector('body');
	var yearTitle = document.querySelectorAll('.year-title');
	var chapters = document.querySelectorAll('.table-of-contents ol li a');
	var details = document.querySelectorAll('details');

	window.addEventListener('scroll', function(){
		for (var i = 0; i < sections.length; i++) {
			if(sections[i].offsetTop-5 <= window.scrollY && sections[i+1].offsetTop > window.scrollY+5) {
				yearTitle[i].classList.add('active-year');
			} else {
				yearTitle[i].classList.remove('active-year');
			}
		}

		for (var i = 0; i < yearTitle.length; i++) {
			if (yearTitle[i].classList.value.split("year-title ")[1] == 'active-year') {
				details[i].open = true;
			} else {
				details[i].open = false;
			}
		}
	});


	</script>
	<script>
		var forms = document.querySelectorAll('.data');
		var buttons = document.querySelectorAll('.submit-chapter');
		var checkboxes = document.querySelectorAll('.data input');

		forms.forEach(function(form){
			form.addEventListener('submit', function(e){
				e.preventDefault();
				var inputs = e.target.elements;
				for(var i = 0; i < inputs.length; i++) {
					if(inputs[i].checked == false) {
						inputs[i].parentElement.parentElement.parentElement.classList.add('hide-me');
					} else {
						inputs[i].parentElement.parentElement.parentElement.classList.remove('hide-me');

					}
				}
			})
		})

		// console.log(checkboxes);
		// for(var i = 0; i < buttons.length; i++) {
		// 	buttons[i].addEventListener('click', function(e){
		// 		e.preventDefault();
		//
		// 		console.log(e);
		//
		// 	});
		// }

	</script>
	<!-- <script>
	var trigger = document.querySelectorAll(".year-title");

	for (	var i = 0; i < trigger.length; i++) {
		trigger[i].addEventListener("click", function() {
				console.log('click');
				/* Toggle between adding and removing the "active" class,
				to highlight the button that controls the panel */
				this.classList.toggle("active");

				/* Toggle between hiding and showing the active panel */
				var panel = this.nextElementSibling;
				if (panel.style.display === "block") {
						panel.style.display = "none";
				} else {
						panel.style.display = "block";
				}
		});
	}
	</script> -->
<%- include('partials/foot.ejs') %>
